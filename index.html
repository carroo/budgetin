<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Mingguan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    /* Animasi untuk notification */
    #notification {
      transition: all 0.3s ease-in-out;
      transform: translateX(-50%) translateY(-20px);
      opacity: 0;
    }
    #notification:not(.hidden) {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    /* Animasi bounce untuk tombol */
    .btn-bounce:hover {
      transform: scale(1.05);
      transition: transform 0.2s ease;
    }
    
    /* Gradient background untuk notification */
    .notif-success { background: linear-gradient(135deg, #10B981, #059669); }
    .notif-error { background: linear-gradient(135deg, #EF4444, #DC2626); }
    .notif-warning { background: linear-gradient(135deg, #F59E0B, #D97706); }
    .notif-info { background: linear-gradient(135deg, #3B82F6, #2563EB); }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-6">

  <!-- ANGKA UTAMA -->
  <div class="text-center space-y-4">
    <h1 class="text-sm text-gray-500 tracking-wide">Saldo Harian</h1>
    <div id="budgetSummary" class="text-xs text-gray-400 -mt-2 hidden">
      <span id="weeklyBudgetAmount">0</span>/<span id="idealDailyBudgetAmount">0</span>
    </div>
    <div class="flex items-center justify-center gap-4">
      <div class="text-center">
        <div class="text-xs text-gray-400 mb-1">Saldo Hari Ini</div>
        <div id="dailyBudget" class="text-6xl font-extrabold text-blue-600">0</div>
      </div>
      <div class="text-center">
        <div class="text-xs text-gray-400 mb-1">Sisa Saldo</div>
        <div id="remainingDaily" class="text-6xl font-extrabold" style="color: #10B981;">0</div>
      </div>
    </div>
    <div class="text-sm text-gray-600">
      <span>Minggu ke-<span id="weekNumber">1</span> | Hari ke-<span id="dayNumber">1</span> | Sisa <span id="daysLeft">7</span> hari</span>
    </div>
  </div>

  <!-- TOMBOL -->
  <div class="mt-8 flex flex-col gap-3 w-full max-w-xs">
    <button onclick="openModal('spendModal')" class="btn-bounce bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">üí∏ Input Pengeluaran</button>
    <button id="budgetButton" onclick="openModal('budgetModal')" class="btn-bounce bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">‚öô Atur Budget</button>
    <button onclick="nextDay()" class="btn-bounce bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700">üåÖ Ganti Hari</button>
  </div>

  <!-- TOMBOL ABSOLUT -->
  <!-- Reset Data - Kiri Bawah -->
  <button onclick="resetData()" class="btn-bounce fixed bottom-6 left-6 w-12 h-12 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700 flex items-center justify-center text-lg">
    üóëÔ∏è
  </button>

  <!-- Riwayat - Kanan Bawah -->
  <button onclick="openModal('historyModal')" class="btn-bounce fixed bottom-6 right-6 w-12 h-12 bg-gray-700 text-white rounded-full shadow-lg hover:bg-gray-800 flex items-center justify-center text-lg">
    üìú
  </button>

  <!-- MODAL: ATUR BUDGET -->
  <div id="budgetModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-xl p-6 w-80">
      <h2 class="text-lg font-bold mb-3 text-center">Atur Budget Mingguan</h2>
      <input id="weeklyBudget" type="number" placeholder="Contoh: 350"
             class="w-full border p-2 rounded-lg mb-4 text-center focus:ring-2 focus:ring-blue-400 outline-none">
      <button onclick="setBudget()" class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700">Simpan</button>
      <button onclick="closeModal('budgetModal')" class="w-full mt-2 text-gray-500">Batal</button>
    </div>
  </div>

  <!-- MODAL: INPUT PENGELUARAN -->
  <div id="spendModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-xl p-6 w-80">
      <h2 class="text-lg font-bold mb-3 text-center">Input Pengeluaran Hari Ini</h2>
      <input id="spendInput" type="number" placeholder="Contoh: 40"
             class="w-full border p-2 rounded-lg mb-4 text-center focus:ring-2 focus:ring-green-400 outline-none">
      <button onclick="addExpense()" class="w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700">Simpan</button>
      <button onclick="closeModal('spendModal')" class="w-full mt-2 text-gray-500">Batal</button>
    </div>
  </div>

  <!-- MODAL: HISTORY -->
  <div id="historyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center overflow-y-auto z-50">
    <div class="bg-white rounded-xl p-6 w-80 max-h-[80vh] overflow-y-auto">
      <h2 class="text-lg font-bold mb-4 text-center">Riwayat Minggu</h2>
      <ul id="historyList" class="space-y-2 text-sm text-gray-700"></ul>
      <button onclick="closeModal('historyModal')" class="w-full mt-4 text-gray-500">Tutup</button>
    </div>
  </div>

  <!-- MODAL: KONFIRMASI RESET -->
  <div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 w-80">
      <div class="text-center mb-4">
        <div class="text-4xl mb-3">‚ö†Ô∏è</div>
        <h2 class="text-lg font-bold text-gray-800">Konfirmasi Reset</h2>
        <p class="text-gray-600 mt-2">Yakin ingin reset semua data? Data minggu ini dan riwayat akan hilang.</p>
      </div>
      <div class="flex gap-3">
        <button onclick="confirmReset()" class="flex-1 bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700">Ya, Reset</button>
        <button onclick="closeModal('confirmModal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-400">Batal</button>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION SYSTEM -->
  <div id="notification" class="hidden fixed top-6 left-1/2 transform -translate-x-1/2 z-50">
    <div class="bg-white rounded-lg shadow-lg border-l-4 p-4 max-w-md">
      <div class="flex items-center">
        <div id="notifIcon" class="text-2xl mr-3"></div>
        <div>
          <div id="notifTitle" class="font-semibold text-gray-800"></div>
          <div id="notifMessage" class="text-sm text-gray-600"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let data = JSON.parse(localStorage.getItem("budgetData")) || null;
    let history = JSON.parse(localStorage.getItem("budgetHistory")) || [];

    // SISTEM NOTIFIKASI
    function showNotification(title, message, type = 'info') {
      const notification = document.getElementById('notification');
      const icon = document.getElementById('notifIcon');
      const titleEl = document.getElementById('notifTitle');
      const messageEl = document.getElementById('notifMessage');
      const container = notification.querySelector('div');
      
      // Reset classes
      container.className = 'bg-white rounded-lg shadow-lg border-l-4 p-4 max-w-md';
      
      // Set icon dan warna berdasarkan type
      switch(type) {
        case 'success':
          icon.textContent = '‚úÖ';
          container.style.borderLeftColor = '#10B981';
          container.style.background = 'linear-gradient(135deg, #ECFDF5, #F0FDF4)';
          break;
        case 'error':
          icon.textContent = '‚ùå';
          container.style.borderLeftColor = '#EF4444';
          container.style.background = 'linear-gradient(135deg, #FEF2F2, #FEF2F2)';
          break;
        case 'warning':
          icon.textContent = '‚ö†Ô∏è';
          container.style.borderLeftColor = '#F59E0B';
          container.style.background = 'linear-gradient(135deg, #FFFBEB, #FEF3C7)';
          break;
        case 'info':
          icon.textContent = '‚ÑπÔ∏è';
          container.style.borderLeftColor = '#3B82F6';
          container.style.background = 'linear-gradient(135deg, #EFF6FF, #DBEAFE)';
          break;
      }
      
      titleEl.textContent = title;
      messageEl.textContent = message;
      
      // Show dengan animasi
      notification.classList.remove('hidden');
      
      // Auto hide setelah 4 detik dengan animasi fade out
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(-50%) translateY(-20px)';
        setTimeout(() => {
          notification.classList.add('hidden');
          notification.style.opacity = '1';
          notification.style.transform = 'translateX(-50%) translateY(0)';
        }, 300);
      }, 4000);
    }

    function updateUI() {
      const dailyBudgetEl = document.getElementById("dailyBudget");
      const remainingDailyEl = document.getElementById("remainingDaily");
      const weekNumberEl = document.getElementById("weekNumber");
      const dayNumberEl = document.getElementById("dayNumber");
      const daysLeftEl = document.getElementById("daysLeft");
      const budgetButtonEl = document.getElementById("budgetButton");
      const budgetSummaryEl = document.getElementById("budgetSummary");
      const weeklyBudgetAmountEl = document.getElementById("weeklyBudgetAmount");
      const idealDailyBudgetAmountEl = document.getElementById("idealDailyBudgetAmount");
      
      if (!data) {
        dailyBudgetEl.textContent = "0";
        remainingDailyEl.textContent = "0";
        weekNumberEl.textContent = "1";
        dayNumberEl.textContent = "1";
        daysLeftEl.textContent = "7";
        remainingDailyEl.style.color = "#10B981";
        budgetButtonEl.style.display = "block"; // Tampilkan tombol budget jika belum ada data
        budgetSummaryEl.classList.add("hidden"); // Sembunyikan budget summary
        return;
      }

      const currentDay = 8 - data.daysLeft;
      const idealDailyBudget = Math.floor(data.weeklyBudget / 7);
      
      // Saldo harian tetap sama untuk hari itu (tidak berubah saat input pengeluaran)
      dailyBudgetEl.textContent = data.dailyBudget.toLocaleString('id-ID');
      remainingDailyEl.textContent = data.dailyRemaining.toLocaleString('id-ID');
      weekNumberEl.textContent = data.week;
      dayNumberEl.textContent = currentDay;
      daysLeftEl.textContent = data.daysLeft;
      
      // Tampilkan budget summary dalam format simple (350000/50000)
      budgetSummaryEl.classList.remove("hidden");
      weeklyBudgetAmountEl.textContent = data.weeklyBudget;
      idealDailyBudgetAmountEl.textContent = idealDailyBudget;
      
      // Sembunyikan tombol budget jika sudah ada data
      budgetButtonEl.style.display = "none";
      
      // Ubah warna sisa saldo berdasarkan positif/negatif
      if (data.dailyRemaining >= 0) {
        remainingDailyEl.style.color = "#10B981"; // hijau
      } else {
        remainingDailyEl.style.color = "#EF4444"; // merah
      }
    }

    function openModal(id) {
      document.getElementById(id).classList.remove("hidden");
    }

    function closeModal(id) {
      document.getElementById(id).classList.add("hidden");
    }

    function setBudget() {
      const budget = parseInt(document.getElementById("weeklyBudget").value);
      if (isNaN(budget) || budget <= 0) {
        showNotification("Input Tidak Valid", "Masukkan nominal yang benar!", "error");
        return;
      }
      
      const dailyBudget = Math.floor(budget / 7);
      data = { 
        weeklyBudget: budget, 
        remaining: budget, 
        dailyBudget: dailyBudget,
        dailyRemaining: dailyBudget,
        daysLeft: 7, 
        spent: 0, 
        week: (history.length + 1) 
      };
      localStorage.setItem("budgetData", JSON.stringify(data));
      closeModal('budgetModal');
      updateUI();
      showNotification("Budget Tersimpan!", `Budget mingguan Rp ${budget.toLocaleString('id-ID')} telah diatur. Saldo harian: Rp ${dailyBudget.toLocaleString('id-ID')}`, "success");
    }

    function addExpense() {
      if (!data) {
        showNotification("Budget Belum Diatur", "Atur budget mingguan terlebih dahulu!", "warning");
        return;
      }
      const spend = parseInt(document.getElementById("spendInput").value);
      if (isNaN(spend) || spend < 0) {
        showNotification("Input Tidak Valid", "Masukkan pengeluaran yang valid!", "error");
        return;
      }
      if (data.daysLeft <= 0) {
        showNotification("Minggu Berakhir", "Minggu sudah berakhir. Mulai minggu baru dulu.", "warning");
        return;
      }

      // HANYA kurangi dari sisa saldo harian (dailyRemaining)
      // Saldo harian (dailyBudget) tetap sama!
      data.dailyRemaining -= spend;
      data.spent += spend;
      data.remaining -= spend;
      
      localStorage.setItem("budgetData", JSON.stringify(data));
      document.getElementById("spendInput").value = "";
      closeModal('spendModal');
      updateUI();
      
      // Notifikasi berdasarkan kondisi sisa saldo
      if (data.dailyRemaining >= 0) {
        showNotification("Pengeluaran Dicatat", `Rp ${spend.toLocaleString('id-ID')} telah dicatat. Sisa saldo hari ini: Rp ${data.dailyRemaining.toLocaleString('id-ID')}`, "success");
      } else {
        showNotification("Over Budget!", `Pengeluaran Rp ${spend.toLocaleString('id-ID')} dicatat. Anda over budget Rp ${Math.abs(data.dailyRemaining).toLocaleString('id-ID')}`, "warning");
      }
    }

    function nextDay() {
      if (!data) {
        showNotification("Budget Belum Diatur", "Atur budget mingguan terlebih dahulu!", "warning");
        return;
      }
      if (data.daysLeft <= 1) {
        showNotification("Minggu Selesai!", "Data minggu ini telah disimpan ke riwayat.", "success");
        history.push({
          week: data.week,
          budget: data.weeklyBudget,
          spent: data.spent,
          remaining: data.remaining
        });
        localStorage.setItem("budgetHistory", JSON.stringify(history));
        localStorage.removeItem("budgetData");
        data = null;
        updateUI();
        return;
      }
      
      // Pindah ke hari berikutnya
      data.daysLeft -= 1;
      
      // Hitung saldo harian baru berdasarkan sisa budget dan sisa hari
      const newDailyBudget = data.daysLeft > 0 ? Math.floor(data.remaining / data.daysLeft) : 0;
      data.dailyBudget = newDailyBudget;
      data.dailyRemaining = newDailyBudget; // Reset sisa saldo untuk hari baru
      
      localStorage.setItem("budgetData", JSON.stringify(data));
      updateUI();
      
      const currentDay = 8 - data.daysLeft;
      showNotification(`Hari ke-${currentDay}!`, `Saldo harian baru: Rp ${newDailyBudget.toLocaleString('id-ID')}. Sisa ${data.daysLeft} hari dalam minggu ini.`, "info");
    }

    function resetData() {
      openModal('confirmModal');
    }

    function confirmReset() {
      localStorage.removeItem("budgetData");
      localStorage.removeItem("budgetHistory");
      data = null;
      history = [];
      closeModal('confirmModal');
      updateUI();
      showNotification("Data Berhasil Di-reset!", "Semua data telah dihapus. Anda dapat memulai dengan budget baru.", "success");
    }

    function loadHistory() {
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      if (history.length === 0) {
        list.innerHTML = "<li class='text-center text-gray-400 py-4'>Belum ada riwayat minggu sebelumnya</li>";
        return;
      }
      history.slice(-10).reverse().forEach(item => {
        const li = document.createElement("li");
        li.className = "bg-gray-50 rounded-md px-3 py-3 border border-gray-200";
        li.innerHTML = `
          <div class="flex justify-between items-center">
            <span class="font-medium text-gray-800">Minggu ${item.week}</span>
            <span class="text-xs text-gray-500">Budget: ${item.budget.toLocaleString('id-ID')}</span>
          </div>
          <div class="text-sm text-gray-600 mt-1">
            Pengeluaran: Rp ${item.spent.toLocaleString('id-ID')} ‚Ä¢ 
            Sisa: <span class="${item.remaining >= 0 ? 'text-green-600' : 'text-red-600'}">Rp ${item.remaining.toLocaleString('id-ID')}</span>
          </div>
        `;
        list.appendChild(li);
      });
    }

    // Saat modal riwayat dibuka
    document.querySelector("[onclick=\"openModal('historyModal')\"]").addEventListener("click", loadHistory);

    updateUI();
  </script>
</body>
</html>